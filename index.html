<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zoom e Arraste na Imagem</title>
<style>
.modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(255, 255, 255, 0.9);
    display: flex; /* Usa flexbox para centralizar */
    justify-content: center;
    align-items: center;
}

/* Adicionado para garantir que o contêiner da imagem seja flexível e centralize o conteúdo */
.modal-content-container {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
}

.modal-content {
    max-width: 100%;
    object-fit: contain;
}

.close {
    position: fixed;
    top: 10px;
    right: 25px;
    color: #373737;
    font-size: 35px;
    font-weight: bold;
    z-index: 2; /* Aumente o z-index para garantir que esteja acima da imagem */
}



.close:hover,
.close:focus {
 color: #bbb;
 text-decoration: none;
 cursor: pointer;
}

.disable-dbl-tap-zoom {
 touch-action: manipulation;
}
</style>
</head>
<body>

<div class="modal" id="myModal">
 <span class="close" onclick="fecharModal()">&times;</span>
 <img class="modal-content disable-dbl-tap-zoom" id="imgZoom">
</div>

<div class="gallery">
 <p>teste X por cima da imagem</p>
 <img src="https://portalsustentabilidade.com/wp-content/uploads/2022/07/design-destaque-24-3.jpg" onclick="abrirModal(this)" style="width: 100%;">
 <img src="https://www.petlove.com.br/images/breeds/227696/profile/original/perfil-coelho.jpg?1597789099" onclick="abrirModal(this)" style="width: 100%;">
 <img src="https://img.freepik.com/fotos-gratis/foto-vertical-de-uma-estrada-com-montanhas-magnificas-sob-o-ceu-azul-capturada-na-california_181624-44891.jpg?size=626&ext=jpg&ga=GA1.1.735520172.1711497600&semt=sph" onclick="abrirModal(this)" style="width: 100%;">
</div>

<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        fecharModal(); // Chama a função que oculta o modal
    });

    var modal = document.getElementById("myModal");
    var modalImg = document.getElementById("imgZoom"); // Referência para a imagem dentro do modal
    var zoomed = false; // Variável para rastrear o estado do zoom

    // Variáveis para rastrear o estado do arraste
    var isDragging = false;
    var dragStartX = 0;
    var dragStartY = 0;

    function abrirModal(img) {
        modal.style.display = "block";
        modalImg.src = img.src;
        modalImg.style.transform = "scale(1)"; // Resetando o zoom ao abrir o modal
        // Resetando a posição da imagem ao abrir o modal
        modalImg.style.left = "0px";
        modalImg.style.top = "0px";
        adicionarZoomComDoisToques();
    }

    function fecharModal() {
        modal.style.display = "none";
    }

    function adicionarZoomComDoisToques() {
    let lastTouchTime = 0;
    let touchStartX = 0;
    let touchStartY = 0;
    let translateX = 0;
    let translateY = 0;

    modalImg.addEventListener("touchstart", function(event) {
        const currentTime = Date.now();
        if (currentTime - lastTouchTime <= 400) {
            event.preventDefault();
            toggleZoom();
            lastTouchTime = 0;
        } else {
            lastTouchTime = currentTime;
            touchStartX = event.touches[0].clientX;
            touchStartY = event.touches[0].clientY;
        }
    }, false);

    modalImg.addEventListener("touchmove", function(event) {
        if (zoomed) {
            event.preventDefault();
            const touchMoveX = event.touches[0].clientX;
            const touchMoveY = event.touches[0].clientY;
            translateX = touchMoveX - touchStartX;
            translateY = touchMoveY - touchStartY;
            modalImg.style.transform = `translate(${translateX}px, ${translateY}px) scale(2)`;
        }
    }, false);
}

    function toggleZoom() {
        if (!zoomed) {
            modalImg.style.transform = "scale(2)";
            zoomed = true;
        } else {
            modalImg.style.transform = "scale(1)";
            zoomed = false;
        }
    }

    // Eventos de arraste para desktop
    modalImg.addEventListener('mousedown', iniciarArraste);
    window.addEventListener('mousemove', arrastar);
    window.addEventListener('mouseup', finalizarArraste);

    function iniciarArraste(e) {
        e.preventDefault();
        isDragging = true;
        dragStartX = e.clientX - modalImg.offsetLeft;
        dragStartY = e.clientY - modalImg.offsetTop;
        modalImg.style.cursor = 'grabbing';
    }

    function arrastar(e) {
        if (isDragging) {
            var newX = e.clientX - dragStartX;
            var newY = e.clientY - dragStartY;
            modalImg.style.left = newX + 'px';
            modalImg.style.top = newY + 'px';
        }
    }

    function finalizarArraste() {
        isDragging = false;
        modalImg.style.cursor = 'grab';
    }
</script>

</body>
</html>
